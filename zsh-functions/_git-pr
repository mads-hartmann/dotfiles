#compdef git-pr
#description Open the pull request preview view on Github

# TODO: This works for git-pr <tab> but not git pr <tab>. The git mechanism is crazy
# http://stackoverflow.com/questions/38725102/how-to-add-custom-git-command-to-zsh-completion
# https://github.com/zsh-users/zsh/blob/cb26725d40a9104ee08e3ca6ff9661890eca8a65/Completion/Unix/Command/_git
# http://zsh.sourceforge.net/Doc/Release/Completion-System.html

_git_pr () {
    local curcontext="$curcontext" state line ret=1
    declare -A opt_args

    remote_branches=$( \
        git branch -r \
        | grep -v 'HEAD' \
        | sed s/origin\\///g \
        | while read -r branch; do echo -n "$branch "; done \
    )

    _arguments ":Remote branch:($(echo ${remote_branches}))"

    return ret
}

_git_pr "%@"
