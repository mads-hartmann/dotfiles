#!/usr/bin/env bash

set -e

# ctags doesn't handle negative look behinds so instead this script
# strips false positives out of a tags file.

# TODO: Exclude thigns in .gitignore
# TODO: Default to . if not folder was provided.
/usr/local/Cellar/ctags/5.8_1/bin/ctags \
    -e \
    --exclude=node_modules \
    --exclude=bower_components \
    --exclude=vendor \
    --exclude=tmp \
    --exclude=lib \
    --recurse \
    --options=/Users/hartmann/dev/personal/dotfiles/ctags/config \
    "$@"

FILE="tags"

while [[ $# > 1 ]]
do
key="$1"

case $key in
    -f)
    FILE="$2"
    shift
    ;;
esac
shift
done

# Filter out false matches from class method regex
sed -i '' -E '/^(if|switch|function|module\.exports|it|describe)	.+language:js$/d' $FILE

# Filter out false matches from object definition regex
sed -i '' -E '/var[ 	]+[a-zA-Z0-9_$]+[ 	]+=[ 	]+require\(.+language:js$/d' $FILE
