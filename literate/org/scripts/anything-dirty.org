#+TITLE: anything-dirty
#+SETUPFILE: /home/babel/dotfiles/literate/etc/options.org

I wrote this script before I had to ship my MBP off to the repair shop.

It just looks through all of my folders in ~~/dev/*/*~ and tells me
if any of the files are dirty.

#+BEGIN_SRC sh :tangle /home/babel/dotfiles/literate/output/tangles/scripts/anything-dirty
#!/usr/bin/env bash

set -euo pipefail

function is-git-repository {
    [[ -d "$1/.git" ]] || (cd "$1" && git rev-parse --git-dir > /dev/null 2>&1)
}

function echo-is-dirty {
    cd "$1"
    if [[ ! -z $(git status -s) ]]
    then echo "is dirty"
    fi
}

function echo-unpushed-branches {
    cd "$1" && git log --branches --not --remotes --no-walk --decorate --oneline
}

function main {
    local pathÂ 
    for kind in $(ls ~/dev); do
        for project in $(ls ~/dev/${kind}); do
            path="${HOME}/dev/${kind}/${project}"
            echo "Checking project ${path}"
            # Check if there are any unpushed branches
            if is-git-repository "${path}"; then
                echo-unpushed-branches "${path}"
                echo-is-dirty "${path}"
            fi
        done
    done
}

main $@
#+END_SRC
